## Сравнение шкалы до и после объединения патологии Endocrine

### 1. Данные и методика

- **Старые данные:** `results/predictions`  
- **Новые данные:** `merged_results/predictions` (добавлен класс `Endocrine`, JSON объединены).  
- Признаки считаются через `aggregate.create_relative_features` (relative_count, relative_area, mean_relative_area).  
- Оценка наборов признаков: PCA (PC1, `random_state=42`), далее метрики:
  - `separation = mean_pc1_mod - mean_pc1_normal`
  - `mean_pc1_norm_mod` (PC1 нормирована в [0, 1])
  - `explained_variance` (доля дисперсии PC1)
  - **Score** = 0.4·separation + 0.3·mean_pc1_norm_mod + 0.3·explained_variance.

### 2. Лучшие эксперименты до объединения

На `results/predictions` (без Endocrine в признаках) лучший эксперимент:

- **Эксперимент:** `feature_selection_all_methods`  
- **Метод:** `forward`  
- **Признаков:** 24 (только “старые” классы)  
- **Метрики:**
  - Score: **3.2644**
  - Separation: 7.3632
  - Mod norm: 0.7067
  - Explained variance: 0.3570

Этот же результат воспроизводится на `merged_results/predictions`, если в признаковое пространство не включать `Endocrine_*`.

### 3. Новый поиск по полному набору признаков (все патологии)

Эксперимент с полным признаковым пространством (все relative‑признаки всех классов, включая Endocrine):

- **Команда:**  
  `run_feature_selection_analysis(predictions_dir=merged_results/predictions, use_all_relative_features=True)`  
- **Лучший эксперимент по Score:** `feature_selection_all_methods_all_relative_full`  
- **Метод:** `forward`  
- **Признаков:** **28**.

**Метрики лучшего эксперимента:**

- Score: **3.5744**  
- Separation: **8.1207**  
- Mod norm: **0.7244**  
- Explained variance: **0.3628**

По сравнению со старой шкалой:

- ΔScore ≈ **+0.31**  
- ΔSeparation ≈ **+0.76**  
- Mod norm и explained variance слегка выросли.

### 4. Новый оптимальный набор признаков

Новый лучший набор (28 признаков, experiment `feature_selection_all_methods_all_relative_full`):

- Mild: `Mild_relative_count`, `Mild_relative_area`
- Neutrophils: `Neutrophils_relative_count`, `Neutrophils_relative_area`, `Neutrophils_mean_relative_area`
- Enterocytes: `Enterocytes_relative_count`, `Enterocytes_relative_area`, `Enterocytes_mean_relative_area`
- Meta: `Meta_relative_count`, `Meta_mean_relative_area`
- Moderate: `Moderate_relative_area`, `Moderate_relative_count`, `Moderate_mean_relative_area`
- Dysplasia: `Dysplasia_relative_count`, `Dysplasia_relative_area`
- EoE: `EoE_relative_count`, `EoE_relative_area`, `EoE_mean_relative_area`
- Paneth: `Paneth_relative_count`, `Paneth_relative_area`
- Plasma Cells: `Plasma Cells_mean_relative_area`
- Структурные: `Surface epithelium_relative_count`, `Surface epithelium_relative_area`, `Muscularis mucosae_relative_count`, `Muscularis mucosae_relative_area`
- **Endocrine:** `Endocrine_relative_count`, `Endocrine_relative_area`, `Endocrine_mean_relative_area`

Ключевой факт: все три `Endocrine_*` признака вошли в итоговый оптимальный набор.

### 5. Выводы для шкалы

1. При ограниченном признаковом пространстве (без Endocrine) оптимум остаётся прежним: 24 признака, Score ≈ 3.26.  
2. При работе на полном наборе признаков всех патологий методика находит более сильную шкалу: 28 признаков, Score ≈ 3.57.  
3. Эндокринная патология вносит измеримый вклад: Endocrine‑признаки входят в оптимальный набор и улучшают разделение mod/normal без ухудшения объяснённой дисперсии.  
4. В dashboard конфигурация по умолчанию теперь берётся из эксперимента `feature_selection_all_methods_all_relative_full` и используется как базовая версия шкалы.



# Управление экспериментами в Dashboard

## Проблема

При работе в dashboard возникает несколько вопросов:
1. Можно ли выбирать эксперимент из dashboard?
2. Если вручную выбирать фичи, не испортит ли это исходный экспериментальный конфиг?
3. Как правильно работать в dashboard, чтобы не испортить ничего?

## Решение

### ✅ Безопасная работа с экспериментами

**Важно:** Dashboard НЕ перезаписывает исходные экспериментальные конфиги!

### Как это работает:

1. **Выбор эксперимента:**
   - В dashboard можно выбрать эксперимент из списка
   - Признаки загружаются из эксперимента
   - Исходный эксперимент НЕ изменяется

2. **Ручной выбор признаков:**
   - Можно вручную изменять признаки в dashboard
   - Изменения сохраняются в `feature_selection_config_relative.json`
   - Исходный эксперимент остается нетронутым

3. **Отслеживание источника:**
   - Dashboard отслеживает, из какого эксперимента загружены признаки
   - При сохранении сохраняется информация об исходном эксперименте
   - Можно вернуться к исходной конфигурации эксперимента

---

## Рабочий процесс

### Вариант 1: Использовать эксперимент как есть

1. **Выбрать эксперимент в dashboard:**
   - В боковой панели выбрать эксперимент из списка
   - Признаки загрузятся автоматически

2. **Использовать для анализа:**
   - Запустить анализ с признаками из эксперимента
   - Исходный эксперимент не изменяется

### Вариант 2: Изменить признаки в dashboard

1. **Выбрать эксперимент:**
   - Загрузить признаки из эксперимента

2. **Изменить признаки:**
   - Вручную выбрать/снять признаки через чекбоксы
   - Нажать "Сохранить конфигурацию"

3. **Что происходит:**
   - ✅ Изменения сохраняются в `feature_selection_config_relative.json`
   - ✅ Исходный эксперимент НЕ изменяется
   - ✅ Сохраняется информация об исходном эксперименте

4. **Вернуться к исходной конфигурации:**
   - Нажать "Восстановить исходную конфигурацию"
   - Или выбрать эксперимент заново

---

## Структура файлов

```
experiments/
└── feature_selection_quick/
    └── best_features_*.json          ← Исходный эксперимент (НЕ изменяется)

scale/
├── feature_selection_config_relative.json  ← Текущая конфигурация dashboard
│                                            (может быть изменена пользователем)
└── feature_selection_config_relative_backup_*.json  ← Резервные копии
```

**Важно:**
- Исходные эксперименты (`experiments/*/best_features_*.json`) **НЕ изменяются**
- Изменения сохраняются только в `feature_selection_config_relative.json`
- Можно всегда вернуться к исходной конфигурации

---

## Рекомендации

### ✅ Безопасные действия:

1. **Выбор эксперимента:**
   - ✅ Можно выбирать любой эксперимент
   - ✅ Исходный эксперимент не изменяется

2. **Изменение признаков:**
   - ✅ Можно изменять признаки в dashboard
   - ✅ Исходный эксперимент не изменяется
   - ✅ Изменения сохраняются отдельно

3. **Сохранение конфигурации:**
   - ✅ Создается резервная копия перед сохранением
   - ✅ Исходный эксперимент не изменяется

### ⚠️ Что нужно помнить:

1. **Исходные эксперименты защищены:**
   - Файлы `experiments/*/best_features_*.json` не изменяются
   - Можно безопасно экспериментировать

2. **Изменения в dashboard:**
   - Сохраняются только в `feature_selection_config_relative.json`
   - Можно вернуться к исходной конфигурации

3. **Резервные копии:**
   - Создаются автоматически при экспорте экспериментов
   - Можно восстановить предыдущую версию

---

## Примеры использования

### Пример 1: Использовать эксперимент без изменений

```bash
# 1. Экспортировать эксперимент в dashboard
python3 -m scale.feature_selection_versioning_cli export feature_selection_quick

# 2. Запустить dashboard
streamlit run scale/dashboard.py

# 3. В dashboard:
#    - Признаки уже загружены из эксперимента
#    - Можно использовать как есть
#    - Исходный эксперимент не изменяется
```

### Пример 2: Изменить признаки в dashboard

```bash
# 1. Экспортировать эксперимент
python3 -m scale.feature_selection_versioning_cli export feature_selection_quick

# 2. Запустить dashboard
streamlit run scale/dashboard.py

# 3. В dashboard:
#    - Выбрать/снять признаки через чекбоксы
#    - Нажать "Сохранить конфигурацию"
#    - Изменения сохраняются в feature_selection_config_relative.json
#    - Исходный эксперимент НЕ изменяется

# 4. Вернуться к исходной конфигурации:
#    - Нажать "Восстановить исходную конфигурацию"
#    - Или экспортировать эксперимент заново
```

### Пример 3: Сравнить разные эксперименты

```bash
# 1. Экспортировать первый эксперимент
python3 -m scale.feature_selection_versioning_cli export feature_selection_quick

# 2. Запустить dashboard, проверить результаты

# 3. Экспортировать второй эксперимент
python3 -m scale.feature_selection_versioning_cli export feature_selection_no_paneth

# 4. Запустить dashboard, сравнить результаты

# 5. Выбрать лучший и использовать его
```

---

## FAQ

### Q: Изменятся ли исходные эксперименты при работе в dashboard?

**A:** Нет! Исходные эксперименты (`experiments/*/best_features_*.json`) **НЕ изменяются**. Изменения сохраняются только в `feature_selection_config_relative.json`.

### Q: Можно ли вернуться к исходной конфигурации эксперимента?

**A:** Да! Можно:
- Нажать "Восстановить исходную конфигурацию" в dashboard
- Или экспортировать эксперимент заново через CLI

### Q: Что происходит при сохранении конфигурации в dashboard?

**A:** 
- Изменения сохраняются в `feature_selection_config_relative.json`
- Сохраняется информация об исходном эксперименте
- Исходный эксперимент НЕ изменяется

### Q: Как выбрать эксперимент в dashboard?

**A:** В боковой панели dashboard будет добавлен селектор экспериментов (планируется в следующей версии). Пока можно использовать CLI для экспорта.

### Q: Можно ли использовать несколько экспериментов одновременно?

**A:** Можно экспортировать разные эксперименты по очереди и сравнивать результаты в dashboard.

---

## Планируемые улучшения

1. **Селектор экспериментов в dashboard:**
   - Выпадающий список доступных экспериментов
   - Автоматическая загрузка признаков
   - Отображение метрик эксперимента

2. **Кнопка восстановления:**
   - Кнопка "Восстановить исходную конфигурацию"
   - Автоматическое восстановление из исходного эксперимента

3. **Отображение источника:**
   - Показывать, из какого эксперимента загружены признаки
   - Показывать, были ли внесены изменения пользователем

---

## Заключение

✅ **Исходные эксперименты защищены** - они не изменяются при работе в dashboard

✅ **Изменения сохраняются отдельно** - только в `feature_selection_config_relative.json`

✅ **Можно вернуться к исходной конфигурации** - через восстановление или повторный экспорт

✅ **Безопасно экспериментировать** - исходные данные не потеряются



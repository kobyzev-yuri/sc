# Критерии классификации PC1_mode

## Текущие критерии

Классификация образцов основана на **позиции на спектральной шкале (0-1)**, которая вычисляется из PC1:

### Формула преобразования:
```
PC1_spectrum = (PC1 - PC1_p1) / (PC1_p99 - PC1_p1)
```

где:
- `PC1_p1` = 1-й процентиль PC1 (нижняя граница)
- `PC1_p99` = 99-й процентиль PC1 (верхняя граница)

### Пороги классификации:

| Спектральная шкала | Класс | Описание |
|-------------------|-------|----------|
| **0.0 - 0.2** | `normal` | Нормальные образцы |
| **0.2 - 0.5** | `mild` | Легкая патология |
| **0.5 - 0.8** | `moderate` | Умеренная патология |
| **0.8 - 1.0** | `severe` | Тяжелая патология |

## Примеры порогов на PC1

Для текущих данных (PC1 диапазон: [-3.3963, 9.1973]):

| Спектральная шкала | PC1 значение | Класс |
|-------------------|--------------|-------|
| 0.0 | -3.3963 | normal |
| 0.2 | -0.8776 | **граница normal/mild** |
| 0.5 | 2.9005 | **граница mild/moderate** |
| 0.8 | 6.6786 | **граница moderate/severe** |
| 1.0 | 9.1973 | severe |

## Распределение образцов

По текущим данным:
- **normal**: 17 образцов (47%)
- **mild**: 16 образцов (44%)
- **moderate**: 1 образец (3%)
- **severe**: 2 образца (6%)

## Примеры классификации

### Normal (0.0 - 0.2):
- `35_wnl_colon_A-1-7`: PC1=-3.49, Spectrum=0.00 → **normal**
- `35_wnl_colon_A-1-1__20220325_111048`: PC1=-1.86, Spectrum=0.12 → **normal**

### Mild (0.2 - 0.5):
- `9_ibd_mod_6mod`: PC1=2.52, Spectrum=0.47 → **mild**
- `9_ibd_mod_4mod`: PC1=2.81, Spectrum=0.49 → **mild**
- `19_hp_S015`: PC1=2.17, Spectrum=0.44 → **mild**

### Moderate (0.5 - 0.8):
- `9_ibd_mod_9mod`: PC1=6.46, Spectrum=0.78 → **moderate**

### Severe (0.8 - 1.0):
- `9_ibd_mod_2mod`: PC1=9.84, Spectrum=1.00 → **severe**
- `19_ibd_mod_S024`: PC1=7.99, Spectrum=0.90 → **severe**

## Обоснование порогов

### Почему 0.2 для normal/mild?
- Нижние 20% спектральной шкалы соответствуют образцам с минимальными патологическими признаками
- Это примерно соответствует первой квартили распределения

### Почему 0.5 для mild/moderate?
- Средняя точка шкалы (50%) разделяет легкую и умеренную патологию
- Образцы выше 0.5 имеют более выраженные патологические изменения

### Почему 0.8 для moderate/severe?
- Верхние 20% спектральной шкалы соответствуют наиболее тяжелым случаям
- Это примерно соответствует верхней квартили распределения

## Альтернативные подходы

### 1. Использование квантилей распределения
Вместо фиксированных порогов можно использовать квантили:
- 0-25%: normal
- 25-50%: mild
- 50-75%: moderate
- 75-100%: severe

### 2. Использование GMM компонентов
GMM автоматически находит компоненты (состояния) в данных и может классифицировать образцы на основе принадлежности к компонентам.

### 3. Адаптивные пороги
Пороги можно настроить на основе:
- Распределения данных
- Экспертных знаний
- Клинических критериев

## Настройка порогов

Пороги можно изменить в файле `scale/spectral_analysis.py`, функция `classify_by_spectrum()`:

```python
def classify_by_spectrum(spectrum_value):
    if spectrum_value < 0.2:      # ← можно изменить
        return "normal"
    elif spectrum_value < 0.5:    # ← можно изменить
        return "mild"
    elif spectrum_value < 0.8:    # ← можно изменить
        return "moderate"
    else:
        return "severe"
```

## Рекомендации

1. **Текущие пороги (0.2, 0.5, 0.8)** - хорошая отправная точка
2. **Валидация** - проверить соответствие классификации клиническим данным
3. **Калибровка** - при необходимости скорректировать пороги на основе экспертной оценки
4. **Документирование** - важно документировать используемые пороги для воспроизводимости



